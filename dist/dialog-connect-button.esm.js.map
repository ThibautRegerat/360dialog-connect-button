{"version":3,"file":"dialog-connect-button.esm.js","sources":["../src/open-popup.js","../src/ConnectButton.tsx"],"sourcesContent":["let windowObjectReference = null;\nlet previousUrl = null;\n\nexport const openSignInWindow = (url, name, baseUrl) => {\n  // remove any existing event listeners\n  window.removeEventListener(\"message\", receiveMessage);\n\n  // window features\n  const strWindowFeatures =\n    \"toolbar=no, menubar=no, width=600, height=900, top=100, left=100\";\n\n  if (windowObjectReference === null || windowObjectReference.closed) {\n    /* if the pointer to the window object in memory does not exist\n      or if such pointer exists but the window was closed */\n    windowObjectReference = window.open(url, name, strWindowFeatures);\n  } else if (previousUrl !== url) {\n    /* if the resource to load is different,\n      then we load it in the already opened secondary window and then\n      we bring such window back on top/in front of its parent window. */\n    windowObjectReference = window.open(url, name, strWindowFeatures);\n    windowObjectReference.focus();\n  } else {\n    /* else the window reference must exist and the window\n      is not closed; therefore, we can bring it back on top of any other\n      window with the focus() method. There would be no need to re-create\n      the window or to reload the referenced resource. */\n    windowObjectReference.focus();\n  }\n\n  // add the listener for receiving a message from the popup\n  window.addEventListener(\n    \"message\",\n    (event) => receiveMessage(event, baseUrl),\n    false\n  );\n  // assign the previous URL\n  previousUrl = url;\n};\n\n\nconst receiveMessage = (event, baseUrl) => {\n  if (event.origin != baseUrl) {\n    return;\n  }\n\n  const { data } = event;\n  const redirectUrl = `${data}`;\n  window.location.search = redirectUrl;\n  // window.history.replaceState({}, \"\", redirectUrl);\n};","import React, {useEffect} from \"react\"\nimport { openSignInWindow } from \"./open-popup\";\n\n\ntype CallbackObject = {\n    client: string\n    channels: string[]\n    revokedChannels?: string[]\n}\n\ntype QueryParameters = {\n  email?: string\n  name?: string\n  state?: string\n  redirect_url?: string\n  partner?: string\n  next?: string\n}\n\n\ninterface IConnectButton extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  className?: string;\n  partnerId: string;\n  callback: (v: CallbackObject) => void;\n  requestedNumber?: string;\n  label?: React.ReactNode;\n  env?: \"local\" | \"staging\" | \"rc\" | \"prod\";\n  queryParameters?: QueryParameters\n}\n\nconst ConnectButton = ({\n  className,\n  partnerId,\n  callback,\n  requestedNumber,\n  label = \"Connect 360dialog\",\n  env=\"prod\",\n  queryParameters,\n  ...props\n}\n: IConnectButton) => {\n\n  const baseUrl =\n    (env === 'local' && 'http://0.0.0.0:8082') ||\n    (env === 'staging' && 'https://admin.hub-staging.360dialog.io') ||\n    (env === 'rc' && 'https://rc-admin.360dialog.io') ||\n    'https://hub.360dialog.com';\n    \n\n  let permissionUrl = requestedNumber\n    ? `${baseUrl}/dashboard/app/${partnerId}/permissions?number=${requestedNumber}`\n    : `${baseUrl}/dashboard/app/${partnerId}/permissions`;\n\n  if (queryParameters) {\n    let values = Object.values(queryParameters)\n    Object.keys(queryParameters).forEach((k, idx) => {\n      if (idx === 0 && !requestedNumber) {\n        permissionUrl = permissionUrl + `?${k}=${values[idx]}`;\n      } else {\n        permissionUrl = permissionUrl + `&${k}=${values[idx]}`;\n      }\n    })\n  }\n\n\n  const getUrlParameter = (params: string, name: string) => {\n    name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\n    var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\");\n    var results = regex.exec(params);\n    return results === null\n      ? \"\"\n      : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\n  };\n\n  useEffect(() => {\n    const params = window.location.search;\n    const client = getUrlParameter(params, \"client\");\n    const channels = getUrlParameter(params, \"channels\");\n    const revokedChannels = getUrlParameter(params, 'revoked');\n\n    if (client && channels) {\n      const channelsArray = channels\n        .substring(1, channels.length - 1)\n        .split(\",\");\n      \n        let callbackObj: CallbackObject = {\n          client: client,\n          channels: channelsArray,\n        };\n\n        if (revokedChannels) {\n          const revokedChannelsArray = revokedChannels\n            .substring(1, revokedChannels.length - 1)\n            .split(',');\n          callbackObj['revokedChannels'] = revokedChannelsArray;\n        }\n        callback(callbackObj);\n\n      // remove search parameters from URL after fetching them\n      // window.history.replaceState(null, \"\", window.location.pathname);\n    }\n\n    // send to parent (opener) window and close small window\n    if (window.opener) {\n      window.opener.postMessage(params);\n      window.close();\n    }\n  }, []);\n\n  return (\n    <button\n      className={className ? className : '360dialog-connect-button'}\n      onClick={() =>\n        openSignInWindow(\n          permissionUrl,\n          'connect-360dialog',\n          window.location.origin\n        )\n      }\n      {...props}\n    >\n      {label}\n    </button>\n  );\n};\n\nexport default ConnectButton"],"names":["windowObjectReference","previousUrl","openSignInWindow","url","name","baseUrl","window","removeEventListener","receiveMessage","strWindowFeatures","closed","open","focus","addEventListener","event","origin","data","redirectUrl","location","search","ConnectButton","className","partnerId","callback","requestedNumber","label","env","queryParameters","props","permissionUrl","values","Object","keys","forEach","k","idx","getUrlParameter","params","replace","regex","RegExp","results","exec","decodeURIComponent","useEffect","client","channels","revokedChannels","channelsArray","substring","length","split","callbackObj","revokedChannelsArray","opener","postMessage","close","React","onClick"],"mappings":"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"}